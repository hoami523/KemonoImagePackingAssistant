# Bilibili专栏图片精准抓取建议

## 背景

在bilibili专栏页面，直接遍历整个页面的`img`标签，容易误抓广告、推广、评论区等无关图片，也会带来性能损耗。为了更高效、精准地抓取正文图片，建议只遍历专栏正文的母元素。

---

## 推荐做法

### 1. 锁定正文容器

专栏正文一般在如下容器内：
```html
<div class="opus-module-content"> ... </div>
```

代码示例：
```js
const container = document.querySelector('.opus-module-content');
const imgList = container ? container.querySelectorAll('img') : [];
```
这样只会抓正文里的图片，广告、评论区、侧边栏的图片都不会被抓到。

### 2. 进一步细化选择器

正文图片一般都在如下结构内：
- `.opus-para-pic`
- `.b-img`
- `.b-img__inner`

可以进一步限定：
```js
const imgList = container ? container.querySelectorAll('.opus-para-pic img') : [];
```
这样能进一步排除无关内容。

### 3. 处理图片src

有些图片src是以`//`开头的，需要补全协议：
```js
function fixUrl(url) {
  if (url.startsWith('//')) return 'https:' + url;
  return url;
}
```

### 4. 性能与准确性

- 只遍历正文容器，图片数量少，速度快，误抓概率极低。
- 结构化的DOM选择器（如`.opus-para-pic img`）能进一步提升准确率。

---

## 建议的抓取流程

1. 获取正文容器：
   ```js
   const container = document.querySelector('.opus-module-content');
   ```
2. 获取所有正文图片：
   ```js
   const imgList = container ? container.querySelectorAll('.opus-para-pic img') : [];
   ```
3. 处理每个图片src：
   ```js
   const urls = Array.from(imgList).map(img => fixUrl(img.src));
   ```
4. 后续可按需过滤尺寸、格式等。

---

## 总结

- 只在`.opus-module-content`下查找图片，甚至可以更细致到`.opus-para-pic img`。
- 这样既快又准，几乎不会抓到广告和推广图。
- 建议开发时优先采用此方案。

如需进一步定制选择器，可结合实际页面结构灵活调整。 